<!DOCTYPE html>
<html>
<head>
  <title>Subrosa Ducky C2</title>
  <style>
    body {
      background: black;
      color: #e0ff01;
      font-family: monospace;
      margin: 0;
      padding: 20px;
    }

    .term-container {
      width: 47.6%;
      float: left;
      margin-right: 2%;
      border: 2px solid #333;
      border-radius: 10px;
      box-shadow: 0 0 10px #e0ff0033;
      transition: box-shadow 0.3s ease-in-out;
    }

    .term-container:hover {
      box-shadow: 0 0 20px #e0ff01, 0 0 30px #ffff66;
    }

    .terminal {
      height: 45vh;
      overflow-y: auto;
      background: #000;
      padding: 10px;
      border: 2px solid #333;
      border-radius: 10px;
      white-space: pre-wrap;
      box-shadow: inset 0 0 5px #e0ff0033;
    }

    .input-wrapper {
      display: flex;
      align-items: center;
      position: relative;
      margin-top: 10px;
    }

    .prompt {
      position: absolute;
      left: 10px;
      color: #e0ff01;
      pointer-events: none;
      z-index: 2;
      text-shadow: 0 0 5px #ffff66;
    }

    .input-wrapper input[type="text"] {
      padding-left: 100px;
      background: #111;
      color: #e0ff01;
      border: 1px solid #333;
      font-family: monospace;
      width: 100%;
      z-index: 1;
      box-shadow: inset 0 0 5px #e0ff0033;
      transition: all 0.2s ease-in-out;
    }

    .input-wrapper input[type="text"]:focus {
      box-shadow: inset 0 0 10px #e0ff33, 0 0 10px #ffff66;
      outline: none;
    }

    button {
      background: #111;
      color: #e1ff00;
      border: 2px solid #e1ff00;
      margin-left: 10px;
      padding: 5px 10px;
      cursor: pointer;
      transition: all 0.2s ease-in-out;
      box-shadow: 0 0 5px #e1ff00, 0 0 10px #ffff33;
    }

    button:hover {
      box-shadow: 0 0 15px #e1ff00, 0 0 25px #ffff33;
      transform: scale(1.05);
    }

    input[type="file"] {
      background: #111;
      color: #e1ff00;
      border: 1px solid #e1ff00;
      margin-top: 10px;
      box-shadow: 0 0 5px #e1ff0033;
    }

    #serverCmdInput {
      padding-left: 190px; /* Adjust for long prompt */
    }

    .clear {
      clear: both;
    }

    /* NUKE button specific styling */
    .nuke-btn {
      background: linear-gradient(45deg, #ff0000, #990000);
      color: #fff;
      border: 2px solid #ff0000;
      box-shadow: 0 0 10px #ff0000, 0 0 20px #ff4444, 0 0 30px #ff6666;
      font-weight: bold;
      text-transform: uppercase;
      animation: pulse 1.5s infinite;
    }

    .nuke-btn:hover {
      box-shadow: 0 0 15px #ff0000, 0 0 30px #ff4444, 0 0 45px #ff6666;
      transform: scale(1.05);
    }

    @keyframes pulse {
      0% { box-shadow: 0 0 5px #ff0000, 0 0 10px #ff4444, 0 0 15px #ff6666; }
      50% { box-shadow: 0 0 15px #ff0000, 0 0 30px #ff4444, 0 0 45px #ff6666; }
      100% { box-shadow: 0 0 5px #ff0000, 0 0 10px #ff4444, 0 0 15px #ff6666; }
    }

    footer {
      text-align: center;
      padding: 15px;
      color: #888;
      font-size: 0.9em;
      text-shadow: 0 0 5px #444;
    }
  </style>
</head>

<body>

  <!-- Left: DuckRosa Terminal -->
  <div class="term-container">
    <div id="terminal" class="terminal">
      <!-- ToDo if connected change on GET Connected from pico -->
      <p>Connected to DuckRosa...</p>
    </div>

    <div class="input-wrapper">
      <span class="prompt">DuckRosa &gt;</span>
      <input type="text" id="cmdInput" placeholder="Type to Ducky" />
      <button onclick="sendCmd()">Send</button>
    </div>
  </div>

  <!-- Right: ServerShell Terminal -->
  <div class="term-container">
    <div id="serverTerminal" class="terminal">
      <!-- ToDo add enable / disable Terminal {Host Machine} RISKS! but handy... -->
      <!-- ToDo If enabled Change turn to green from static red for disabled -->
      <p>Server Shell Disabled...</p>
    </div>

    <div class="input-wrapper">
      <span class="prompt">amiscreantðŸ’€duckrosa &gt;</span>
      <input type="text" id="serverCmdInput" placeholder="Type to Server Shell" />
      <button onclick="sendServerCmd()">Send</button>
    </div>
  </div>

  <div class="clear"></div>
  <div style="margin-top: 30px;">
    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>Pico</b></legend>
      <button onclick="sendPicoCmdWithPayload('wifiScan')"><b>WiFi [SCAN]</b></button>
      <button onclick="sendPicoCmdWithPayload('bluetoothScan')"><b>Bluetooth [SCAN]</b></button>
      <button onclick="sendPicoCmdWithPayload('webServerStart')"><b>Web Server [START]</b></button>
      <button onclick="sendPicoCmdWithPayload('webServerStop')"><b>Web Server [STOP]</b></button>
      <button onclick="sendPicoCmdWithPayload('fakeApStart')"><b>Fake AP [START]</b></button>
      <button onclick="sendPicoCmdWithPayload('fakeApStop')"><b>Fake AP [STOP]</b></button>
      <button onclick="sendPicoCmdWithPayload('gattServerStart')"><b>GATT Server [START]</b></button>
      <button onclick="sendPicoCmdWithPayload('gattServerStop')"><b>GATT Server [STOP]</b></button>
      <button onclick="sendPicoCmdWithPayload('currentTime')"><b>Duckrosa [TIME]</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>Server</b></legend>
      <button onclick="sendServerCmdWithPayload('serverSleep')"><b>Duckrosa [SLEEP]</b></button>
      <button onclick="sendServerCmdWithPayload('serverDormant')"><b>Duckrosa [DORMANT]</b></button>
      <button onclick="sendServerCmdWithPayload('serverWakeUp')"><b>Duckrosa [WAKE UP]</b></button>
      <button onclick="sendServerCmdWithPayload('serverPivot')"><b>Duckrosa [PIVOT]</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>Remote-Exploitation</b></legend>
      <button onclick="sendRemoteCmdWithPayload('remoteSleep')"><b>Duckrosa [SLEEP]</b></button>
      <button onclick="sendRemoteCmdWithPayload('remoteDormant')"><b>Duckrosa [DORMANT]</b></button>
      <button onclick="sendRemoteCmdWithPayload('remoteWakeUp')"><b>Duckrosa [WAKE UP]</b></button>
      <button onclick="sendRemoteCmdWithPayload('remoteInformationGathering')"><b>Duckrosa [GATHER]</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>Post-Exploitation</b></legend>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationSleep')"><b>Duckrosa [SLEEP]</b></button>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationDormant')"><b>Duckrosa [DORMANT]</b></button>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationWakeUp')"><b>Duckrosa [WAKE UP]</b></button>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationPivot')"><b>Duckrosa [PIVOT]</b></button>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationSetupDir')"><b>Duckrosa [SETUP DIR]</b></button>
      <button onclick="sendPostExploitationCmdWithPayload('postExploitationSetupUser')"><b>Duckrosa [CREATE USER]</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>HID</b></legend>
      <button onclick="sendHIDCmdWithPayload('android')"><b>Android [HID]</b></button>
      <button onclick="sendHIDCmdWithPayload('iphone')"><b>IPhone [HID]</b></button>
      <button onclick="sendHIDCmdWithPayload('linux')"><b>Linux [HID]</b></button>
      <button onclick="sendHIDCmdWithPayload('windows')"><b>Windows [HID]</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px; margin-bottom: 20px;">
      <legend style="color: #e0ff01;"><b>NUKE</b></legend>
      <button class="nuke-btn" onclick="sendPicoCmdWithPayload('fetchNuke')">Duckrosa [NUKE]</button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px;">
      <legend style="color: #e0ff01;"><b>Upload HID</b></legend>
      <input type="file" id="hidUploader" />
      <button onclick="uploadBin()"><b>Upload HID Payload</b></button>
    </fieldset>

    <fieldset style="border: 2px solid #333; padding: 10px;">
      <legend style="color: #e0ff01;"><b>Upload Bin</b></legend>
      <input type="file" id="binUploader" />
      <button onclick="uploadBin()"><b>Upload Bin Payload</b></button>
    </fieldset>
  </div>

  <script>
    const API_KEY = "supersecretkey"; // must match Flask

    const post_exploitation_payloads = {
      postExploitationSleep: "post_exploitation_sleep",
      postExploitationDormant: "post_exploitation_dormant",
      postExploitationWakeUp: "post_exploitation_wake_up",
      postExploitationPivot: "post_exploitation_pivot",
      postExploitationSetupDir: "post_exploitation_setup_dir",
      postExploitationSetupUser: "post_exploitation_setup_remote_user"
    };

    // Optional additional categories (kept for structure)
    const server_payloads = {
      serverSleep: "server_sleep",
      serverDormant: "server_dormant",
      serverWakeUp: "server_wake_up",
      serverPivot: "server_pivot"
    };

    const server_hid_payloads = {
      android: "android_hid",
      iphone: "iphone_hid",
      linux: "linux_hid",
      windows: "windows_hid"
    };

    const pico_payloads = {
      wifiScan: "wifi_scan",
      bluetoothScan: "bluetooth_scan",
      webServerStart: "web_server_start",
      webServerStop: "web_server_stop",
      fakeApStart: "fake_ap_start",
      fakeApStop: "fake_ap_stop",
      gattServerStart: "bluetooth_gatt_start",
      gattServerStop: "bluetooth_gatt_stop",
      currentTime: "server_time",
      fetchNuke: "fetch_nuke"
    };

    const remote_payloads = {
      remoteSleep: "remote_sleep",
      remoteDormant: "remote_dormant",
      remoteWakeUp: "remote_wake_up",
      remoteInformationGathering: "remote_information_gathering"
    };

    function pollResults() {
      fetch("/getresults", {
        method: "GET",
        headers: {
          "X-API-KEY": API_KEY
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.result) {
          const terminal = document.getElementById("terminal");
          const isError = data.result.toLowerCase().includes("error") || data.result.includes("ðŸ’€");
          terminal.innerHTML += `<p><span style="color:${isError ? "red" : "lime"}">[Pico]</span> ${data.result}</p>`;
          terminal.scrollTop = terminal.scrollHeight;
        }
      })
      .catch(err => console.error("Error fetching results:", err));
    }

    // poll every 3s
    setInterval(pollResults, 3000);

    function sendCmd() {
      const cmd = document.getElementById("cmdInput").value;
      if (!cmd) return;
      fetch("/setcmd", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-API-KEY": API_KEY
        },
        body: JSON.stringify({ command: cmd })
      });
      const terminal = document.getElementById("terminal");
      terminal.innerHTML += `<p>DuckRosa &gt; ${cmd}</p>`;
      document.getElementById("cmdInput").value = "";
      terminal.scrollTop = terminal.scrollHeight;
    }

    function sendPostExploitationCmdWithPayload(key) {
      document.getElementById("cmdInput").value = post_exploitation_payloads[key];
      sendCmd();
    }

    function sendServerCmdWithPayload(key) {
      document.getElementById("cmdInput").value = server_payloads[key];
      sendCmd();
    }

    function sendRemoteCmdWithPayload(key) {
      document.getElementById("cmdInput").value = remote_payloads[key];
      sendCmd();
    }

    function sendHIDCmdWithPayload(key) {
      document.getElementById("cmdInput").value = server_hid_payloads[key];
      sendCmd();
    }

    function sendPicoCmdWithPayload(key) {
      document.getElementById("cmdInput").value = pico_payloads[key];
      sendCmd();
    }

    function sendServerCmd() {
      const cmd = document.getElementById("serverCmdInput").value;
      if (!cmd) return;

      serverHistory.push(cmd);
      serverHistoryIndex = serverHistory.length;

      const terminal = document.getElementById("serverTerminal");
      terminal.innerHTML += `<p>amiscreantðŸ’€duckrosa &gt; ${cmd}</p>`;

      fetch("/setcmd", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-API-KEY": API_KEY
        },
        body: JSON.stringify({ command: cmd })
      });

      document.getElementById("serverCmdInput").value = "";
      terminal.scrollTop = terminal.scrollHeight;
    }

    async function uploadBin() {
      const file = document.getElementById("binUploader").files[0];
      if (!file) {
        alert("Please select a .uf2 or .bin file first!");
        return;
      }

      const formData = new FormData();
      formData.append("binfile", file);

      try {
        const res = await fetch("/uploadbin", {
          method: "POST",
          headers: { "X-API-KEY": API_KEY },
          body: formData
        });

        if (res.ok) {
          const data = await res.json();
          alert("Upload successful: " + data.filename);
        } else {
          alert("Upload failed: " + res.status);
        }
      } catch (err) {
        alert("Error: " + err);
      }
    }

    let serverHistory = [];
    let serverHistoryIndex = -1;

    document.getElementById("serverCmdInput").addEventListener("keydown", function(e) {
      if (e.key === "ArrowUp") {
        if (serverHistoryIndex > 0) {
          serverHistoryIndex--;
          this.value = serverHistory[serverHistoryIndex];
        }
        e.preventDefault();
      } else if (e.key === "ArrowDown") {
        if (serverHistoryIndex < serverHistory.length - 1) {
          serverHistoryIndex++;
          this.value = serverHistory[serverHistoryIndex] || "";
        }
        e.preventDefault();
      } else if (e.key === "Enter") {
        sendServerCmd();
      }
    });
    function handleLocalServerCmd(cmd) {
      const terminal = document.getElementById("serverTerminal");
      if (cmd === "help") {
        terminal.innerHTML += `<p><b>All Help Options: </b></p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p><b>help duckrosa                   - Display Pico Commands</b>                        </p>`;
        terminal.innerHTML += `<p><b>help server                     - Display Server Commands</b>                      </p>`;
        terminal.innerHTML += `<p><b>help remote_payloads            - Display Remote Payload Options</b>               </p>`;
        terminal.innerHTML += `<p><b>help post_exploitation_payloads - Display Post Exploitation Payload Options</b>    </p>`;
        terminal.innerHTML += `<p><b>help hid_payloads               - Display HID Payload Options</b>                  </p>`;
        terminal.innerHTML += `<p><b>help menu                       - Display Menu Options</b>                         </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>Available commands: help, help duckrosa, help server, help remote_payloads,</b>    </p>`;
        terminal.innerHTML += `<p><b>help post_exploitation_payloads, help hid_payloads, help menu </b>                 </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help server") {
        terminal.innerHTML += `<p>Server Help Commands: </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>Server commands: server_sleep, server_dormant, server_wake_up</b> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help remote_payloads") {
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>Payloads: setup_dir, setup_remote_user, remote_information_gathering</b></p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help post_exploitation_payloads") {
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>Payloads: setup_dir, setup_remote_user, remote_information_gathering</b></p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help hid_payloads") {
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> <b>android_hid  - Trigger selected android HID Payload upon USB connection.</b></p>`;
        terminal.innerHTML += `<p> <b>iphone_hid   - Trigger selected iphone HID Payload upon USB connection.</b></p>`;
        terminal.innerHTML += `<p> <b>linux_hid    - Trigger selected linux HID Payload upon USB connection.</b></p>`;
        terminal.innerHTML += `<p> <b>windows_hid  - Trigger selected windows HID Payload upon USB connection.</b></p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>Payloads: android_hid, iphone_hid, linux_hid, windows_hid </b></p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help duckrosa") {
        terminal.innerHTML += `<p>DuckRosa - Pico: </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> <i>These Commands are directly used on</i> <b>Pico W./DuckRosa</b> </p>`;
        terminal.innerHTML += `<p> <i>These will not run on Remote Machines.</i> </p>`;
        terminal.innerHTML += `<p> <i>All Information is sent back to the server.</i> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> <b>wifi_scan         - WiFi Scan, will scan for local Network Connections.</b>             </p>`;
        terminal.innerHTML += `<p> <b>bluetooth_scan    - Bluetooth Scan, will scan for nearby activate bluetooth devices.</b></p>`;
        terminal.innerHTML += `<p> <b>web_server_start  - WebServer Start, starts the webserver.</b>                          </p>`;
        terminal.innerHTML += `<p> <b>web_server_stop   - WebServer Stop, stops the webserver.</b>                            </p>`;
        terminal.innerHTML += `<p> <b>fake_ap_start     - Fake AP Start, starts the fake access point.</b>                    </p>`;
        terminal.innerHTML += `<p> <b>fake_ap_stop      - Fake AP Stop, stops the fake access point.</b>                      </p>`;
        terminal.innerHTML += `<p> <b>gatt_server_start - GATT Server start on the Pico W.</b>                                </p>`;
        terminal.innerHTML += `<p> <b>gatt_server_stop  - GATT Server stop on the Pico W.</b>                                 </p>`;
        terminal.innerHTML += `<p> <b>fetch_nuke        - Downloads nuke.uf2 to reset the Pico W.</b></p>`;
        terminal.innerHTML += `<p> </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        terminal.innerHTML += `<p><b>DuckRosa Pico controls: wifi_scan, bluetooth_scan, web_server_start, web_server_stop,</b>  </p>`;
        terminal.innerHTML += `<p>                        <b>fake_ap_start, fake_ap_stop, gatt_server_start,</b>                </p>`;
        terminal.innerHTML += `<p>                        <b>gatt_server_stop</b>                                               </p>`;
        terminal.innerHTML += `<p> _____________________________________________________________________________________</p>`;
        return true;
      }
      if (cmd === "help menu") {
        terminal.innerHTML += `<p><b>Use the C2 buttons or type help for commands.</b></p>`;
        return true;
      }
      return false;
    }

    function sendServerCmd() {
      const cmd = document.getElementById("serverCmdInput").value;
      if (!cmd) return;

      serverHistory.push(cmd);
      serverHistoryIndex = serverHistory.length;

      const terminal = document.getElementById("serverTerminal");
      terminal.innerHTML += `<p>amiscreantðŸ’€duckrosa &gt; ${cmd}</p>`;

      // Check if local help/menu
      if (handleLocalServerCmd(cmd)) {
        document.getElementById("serverCmdInput").value = "";
        terminal.scrollTop = terminal.scrollHeight;
        return;
      }

      // Otherwise forward to backend
      fetch("/setcmd", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-API-KEY": API_KEY
        },
        body: JSON.stringify({ command: cmd })
      });

      document.getElementById("serverCmdInput").value = "";
      terminal.scrollTop = terminal.scrollHeight;
    }
  </script>
<footer>aMiscreant</footer>
</body>
</html>